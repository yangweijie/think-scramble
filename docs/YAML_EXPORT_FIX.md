# YAML å¯¼å‡ºåŠŸèƒ½ä¿®å¤

## é—®é¢˜æè¿°

åœ¨è¿è¡Œ `php think scramble:export -f yaml` å‘½ä»¤æ—¶ï¼Œé‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š

```
Export failed: YAML extension is not available
```

è¿™æ˜¯å› ä¸º PHP ç¯å¢ƒä¸­æ²¡æœ‰å®‰è£… YAML æ‰©å±•ã€‚

## è§£å†³æ–¹æ¡ˆ

æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå†…ç½®çš„ YAML ç”Ÿæˆå™¨ï¼Œæ— éœ€å®‰è£…é¢å¤–çš„ PHP æ‰©å±•å³å¯å¯¼å‡º YAML æ ¼å¼çš„ API æ–‡æ¡£ã€‚

### ğŸ”§ ä¿®å¤å†…å®¹

1. **æ–°å¢ YamlGenerator ç±»** (`src/Utils/YamlGenerator.php`)
   - æä¾›çº¯ PHP å®ç°çš„ YAML ç”ŸæˆåŠŸèƒ½
   - æ”¯æŒå¤æ‚çš„åµŒå¥—ç»“æ„
   - æ­£ç¡®å¤„ç†ç‰¹æ®Šå­—ç¬¦å’Œ YAML å…³é”®å­—
   - æ™ºèƒ½æ£€æµ‹æ˜¯å¦éœ€è¦å¼•å·

2. **ä¿®æ”¹ ExportCommand** (`src/Command/ExportCommand.php`)
   - ä½¿ç”¨æ–°çš„ YamlGenerator æ›¿ä»£åŸç”Ÿ YAML æ‰©å±•
   - ä¼˜å…ˆä½¿ç”¨åŸç”Ÿæ‰©å±•ï¼Œå¦‚æœä¸å¯ç”¨åˆ™ä½¿ç”¨å†…ç½®ç”Ÿæˆå™¨

3. **ä¿®æ”¹ DocsController** (`src/Controller/DocsController.php`)
   - æ›´æ–° YAML ç«¯ç‚¹ä»¥ä½¿ç”¨æ–°çš„ç”Ÿæˆå™¨
   - ç§»é™¤å¯¹ YAML æ‰©å±•çš„å¼ºåˆ¶ä¾èµ–

4. **ä¿®æ”¹ OpenApiGenerator** (`src/Generator/OpenApiGenerator.php`)
   - æ›´æ–° `generateYaml()` æ–¹æ³•ä½¿ç”¨æ–°çš„ç”Ÿæˆå™¨

### ğŸš€ ä½¿ç”¨æ–¹æ³•

ç°åœ¨ä½ å¯ä»¥æ­£å¸¸ä½¿ç”¨ YAML å¯¼å‡ºåŠŸèƒ½ï¼š

```bash
# å¯¼å‡ºä¸º YAML æ ¼å¼
php think scramble:export -f yaml

# æŒ‡å®šè¾“å‡ºæ–‡ä»¶
php think scramble:export -f yaml -o docs/api.yaml

# ç”Ÿæˆ YAML æ ¼å¼æ–‡æ¡£
php think scramble:generate --format=yaml

# é€šè¿‡ Web æ¥å£è®¿é—® YAML
curl http://localhost:8000/docs/api.yaml
```

### ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

#### 1. æ™ºèƒ½ YAML ç”Ÿæˆ
- **è‡ªåŠ¨ç±»å‹æ£€æµ‹**ï¼šæ­£ç¡®å¤„ç†å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ã€null
- **æ•°ç»„å¤„ç†**ï¼šåŒºåˆ†é¡ºåºæ•°ç»„å’Œå…³è”æ•°ç»„
- **åµŒå¥—ç»“æ„**ï¼šæ”¯æŒä»»æ„æ·±åº¦çš„åµŒå¥—å¯¹è±¡å’Œæ•°ç»„
- **ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰**ï¼šè‡ªåŠ¨è½¬ä¹‰å¼•å·ã€æ¢è¡Œç¬¦ç­‰ç‰¹æ®Šå­—ç¬¦

#### 2. å…¼å®¹æ€§
- **å‘åå…¼å®¹**ï¼šå¦‚æœç³»ç»Ÿå®‰è£…äº† YAML æ‰©å±•ï¼Œä¼˜å…ˆä½¿ç”¨åŸç”Ÿæ‰©å±•
- **é™çº§å¤„ç†**ï¼šå¦‚æœåŸç”Ÿæ‰©å±•ä¸å¯ç”¨ï¼Œè‡ªåŠ¨ä½¿ç”¨å†…ç½®ç”Ÿæˆå™¨
- **é”™è¯¯å¤„ç†**ï¼šæä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå»ºè®®

#### 3. OpenAPI ä¼˜åŒ–
- **æ–‡æ¡£å¤´éƒ¨**ï¼šè‡ªåŠ¨æ·»åŠ  OpenAPI è§„èŒƒæ³¨é‡Š
- **æ—¶é—´æˆ³**ï¼šåŒ…å«ç”Ÿæˆæ—¶é—´ä¿¡æ¯
- **æ ¼å¼åŒ–**ï¼šç¬¦åˆ OpenAPI 3.0 YAML è§„èŒƒ

### ğŸ“ ç¤ºä¾‹è¾“å‡º

ç”Ÿæˆçš„ YAML æ–‡æ¡£æ ¼å¼å¦‚ä¸‹ï¼š

```yaml
# OpenAPI 3.0 Specification
# Generated by ThinkScramble
# 2025-01-25 23:45:00

openapi: 3.0.0
info:
  title: My API
  version: 1.0.0
  description: API documentation generated by ThinkScramble
servers:
  - url: https://api.example.com
    description: Production server
paths:
  /users:
    get:
      summary: Get users
      tags:
        - users
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
          maxLength: 100
      required:
        - id
        - name
```

### ğŸ” æŠ€æœ¯ç»†èŠ‚

#### YamlGenerator ç±»æ–¹æ³•

```php
// åŸºæœ¬ç¼–ç 
YamlGenerator::encode(array $data, int $indent = 0): string

// OpenAPI ä¸“ç”¨ç”Ÿæˆ
YamlGenerator::generateOpenApiYaml(array $document): string

// æ™ºèƒ½ç”Ÿæˆï¼ˆä¼˜å…ˆä½¿ç”¨åŸç”Ÿæ‰©å±•ï¼‰
YamlGenerator::dump(array $data): string

// æ£€æŸ¥åŸç”Ÿæ‰©å±•æ”¯æŒ
YamlGenerator::hasNativeYamlSupport(): bool
```

#### ç‰¹æ®Šå¤„ç†è§„åˆ™

1. **å­—ç¬¦ä¸²å¼•å·è§„åˆ™**
   - åŒ…å« YAML ç‰¹æ®Šå­—ç¬¦æ—¶è‡ªåŠ¨åŠ å¼•å·
   - YAML å…³é”®å­—ï¼ˆtrueã€falseã€null ç­‰ï¼‰è‡ªåŠ¨åŠ å¼•å·
   - æ•°å­—å­—ç¬¦ä¸²è‡ªåŠ¨åŠ å¼•å·ä»¥é¿å…ç±»å‹æ··æ·†

2. **æ•°ç»„å¤„ç†**
   - é¡ºåºæ•°ç»„ä½¿ç”¨ `- item` æ ¼å¼
   - å…³è”æ•°ç»„ä½¿ç”¨ `key: value` æ ¼å¼
   - åµŒå¥—æ•°ç»„æ­£ç¡®ç¼©è¿›

3. **ç±»å‹è½¬æ¢**
   - `null` â†’ `null`
   - `true` â†’ `true`
   - `false` â†’ `false`
   - æ•°å­—ä¿æŒåŸæ ¼å¼
   - å­—ç¬¦ä¸²æ ¹æ®å†…å®¹å†³å®šæ˜¯å¦åŠ å¼•å·

### ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•ä»¥éªŒè¯åŠŸèƒ½ï¼š

```bash
# è¿è¡Œ YAML ç”Ÿæˆå™¨æµ‹è¯•
php vendor/bin/phpunit tests/YamlGeneratorTest.php

# æµ‹è¯•å¯¼å‡ºå‘½ä»¤
php think scramble:export -f yaml --output=test.yaml

# éªŒè¯ç”Ÿæˆçš„æ–‡ä»¶
cat test.yaml
```

### ğŸ”§ æ•…éšœæ’é™¤

#### 1. å¯¼å‡ºå¤±è´¥
```bash
# æ£€æŸ¥æƒé™
ls -la exports/

# åˆ›å»ºè¾“å‡ºç›®å½•
mkdir -p exports/

# ä½¿ç”¨ç»å¯¹è·¯å¾„
php think scramble:export -f yaml -o /path/to/output.yaml
```

#### 2. æ ¼å¼é—®é¢˜
```bash
# éªŒè¯ YAML æ ¼å¼
php -r "
\$yaml = file_get_contents('exports.yaml');
echo 'YAML file size: ' . strlen(\$yaml) . ' bytes' . PHP_EOL;
echo 'First 200 chars:' . PHP_EOL . substr(\$yaml, 0, 200) . PHP_EOL;
"
```

#### 3. æ€§èƒ½é—®é¢˜
å¯¹äºå¤§å‹ API æ–‡æ¡£ï¼ŒYAML ç”Ÿæˆå¯èƒ½éœ€è¦æ›´å¤šæ—¶é—´ã€‚å¯ä»¥è€ƒè™‘ï¼š
- ä½¿ç”¨ JSON æ ¼å¼ï¼ˆæ›´å¿«ï¼‰
- åˆ†æ‰¹å¯¼å‡º
- å¢åŠ  PHP å†…å­˜é™åˆ¶

### ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æ–¹æ³• | é€Ÿåº¦ | å†…å­˜ä½¿ç”¨ | ä¾èµ– |
|------|------|----------|------|
| åŸç”Ÿ YAML æ‰©å±• | æœ€å¿« | æœ€å°‘ | éœ€è¦æ‰©å±• |
| å†…ç½®ç”Ÿæˆå™¨ | ä¸­ç­‰ | ä¸­ç­‰ | æ— ä¾èµ– |
| Symfony YAML | è¾ƒæ…¢ | è¾ƒå¤š | éœ€è¦åŒ… |

### ğŸ¯ æœ€ä½³å®è·µ

1. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå»ºè®®å®‰è£… YAML æ‰©å±•ä»¥è·å¾—æœ€ä½³æ€§èƒ½
2. **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨å†…ç½®ç”Ÿæˆå™¨å³å¯æ»¡è¶³éœ€æ±‚
3. **CI/CD**ï¼šåœ¨æ„å»ºè„šæœ¬ä¸­é¢„ç”Ÿæˆ YAML æ–‡æ¡£
4. **ç‰ˆæœ¬æ§åˆ¶**ï¼šå°†ç”Ÿæˆçš„ YAML æ–‡ä»¶åŠ å…¥ `.gitignore`

### ğŸ”„ å‡çº§è¯´æ˜

æ­¤ä¿®å¤å®Œå…¨å‘åå…¼å®¹ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ã€‚å¦‚æœä½ ä¹‹å‰å› ä¸º YAML æ‰©å±•é—®é¢˜æ— æ³•ä½¿ç”¨ YAML å¯¼å‡ºåŠŸèƒ½ï¼Œç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

å¦‚æœä½ çš„ç³»ç»Ÿå·²ç»å®‰è£…äº† YAML æ‰©å±•ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨åŸç”Ÿæ‰©å±•ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚
